<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2048 RL Agent Demo</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.21.0/dist/ort.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>2048 RL Agent</h1>
            <p class="subtitle">Trained with PPO-Clip Reinforcement Learning</p>
        </header>

        <div class="mode-selector">
            <button id="replay-mode-btn" class="mode-btn active">Replay Best Game</button>
            <button id="live-mode-btn" class="mode-btn">Live AI Play</button>
        </div>

        <main class="game-area">
            <div class="game-container">
                <div class="score-display">
                    <div class="score-box">
                        <span class="score-label">Score</span>
                        <span id="current-score" class="score-value">0</span>
                    </div>
                    <div class="score-box">
                        <span class="score-label">Move</span>
                        <span id="move-count" class="score-value">0</span>
                    </div>
                </div>

                <div id="game-board" class="game-board">
                    <!-- 4x4 grid will be generated by JS -->
                </div>

                <div class="action-display">
                    <span id="last-action" class="action-label">-</span>
                    <span id="points-earned" class="points-earned"></span>
                </div>
            </div>

            <div class="controls-panel">
                <!-- Replay Controls -->
                <div id="replay-controls" class="controls">
                    <h3>Replay Controls</h3>
                    <div class="control-row">
                        <button id="replay-start" class="control-btn" title="Go to start">⏮</button>
                        <button id="replay-prev" class="control-btn" title="Previous move">◀</button>
                        <button id="replay-play" class="control-btn" title="Play/Pause">▶</button>
                        <button id="replay-next" class="control-btn" title="Next move">▶</button>
                        <button id="replay-end" class="control-btn" title="Go to end">⏭</button>
                    </div>
                    <div class="control-row">
                        <label for="replay-speed">Speed:</label>
                        <input type="range" id="replay-speed" min="100" max="2000" value="500" step="100">
                        <span id="replay-speed-value">500ms</span>
                    </div>
                    <div class="game-info">
                        <p>Best Game Score: <strong id="best-game-score">-</strong></p>
                        <p>Total Moves: <strong id="best-game-moves">-</strong></p>
                    </div>
                </div>

                <!-- Live Mode Controls -->
                <div id="live-controls" class="controls hidden">
                    <h3>Live AI Controls</h3>
                    <div class="control-row">
                        <button id="live-start" class="control-btn">Start</button>
                        <button id="live-stop" class="control-btn" disabled>Stop</button>
                        <button id="live-reset" class="control-btn">Reset</button>
                    </div>
                    <div class="control-row">
                        <label for="live-speed">Speed:</label>
                        <input type="range" id="live-speed" min="50" max="1000" value="200" step="50">
                        <span id="live-speed-value">200ms</span>
                    </div>
                    <div class="model-status">
                        <p>Model: <span id="model-status">Loading...</span></p>
                    </div>
                    <div class="action-probs" id="action-probs">
                        <h4>Action Probabilities</h4>
                        <div class="prob-row"><span>↑ UP:</span><div class="prob-bar"><div id="prob-up" class="prob-fill"></div></div><span id="prob-up-val">0%</span></div>
                        <div class="prob-row"><span>↓ DOWN:</span><div class="prob-bar"><div id="prob-down" class="prob-fill"></div></div><span id="prob-down-val">0%</span></div>
                        <div class="prob-row"><span>← LEFT:</span><div class="prob-bar"><div id="prob-left" class="prob-fill"></div></div><span id="prob-left-val">0%</span></div>
                        <div class="prob-row"><span>→ RIGHT:</span><div class="prob-bar"><div id="prob-right" class="prob-fill"></div></div><span id="prob-right-val">0%</span></div>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>
                <a href="https://github.com/osilkin/rl-fun" target="_blank">View Source on GitHub</a>
            </p>
        </footer>
    </div>

    <script src="js/game.js"></script>
    <script src="js/model.js"></script>
    <script src="js/ui.js"></script>
</body>
</html>
